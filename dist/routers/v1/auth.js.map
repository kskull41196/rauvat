{"version":3,"sources":["../../../build/routers/v1/auth.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","services_1","require","express","base_1","controllers_1","middlewares_1","crypto","CONVERT_MD5","ENCODING","TWO_MONTHS_IN_SECONDS","AuthRouter","router","Router","post","route","login","registerUser","put","getPassword","get","getToken","employeeLogin","testMiddlewares","authInfoMiddleware","run","req","res","tokenService","generateToken","token","onSuccess","md5Password","createHash","update","body","password","digest","userController","fullname","undefined","sex","birthday","Date","address","email","create","md5_password","checkLogin","dataObtained","dataValues","role","getUserToken","id","validateJSON","type","properties","id_token","required","bearer","split","bearerToken","authController","BaseRouter","default"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","file":"auth.js","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst services_1 = require(\"@/services\");\nconst express = require(\"express\");\nconst base_1 = require(\"../base\");\nconst controllers_1 = require(\"@/controllers\");\nconst middlewares_1 = require(\"@/middlewares\");\nconst crypto = require(\"crypto\");\nconst CONVERT_MD5 = 'md5';\nconst ENCODING = 'hex';\nconst TWO_MONTHS_IN_SECONDS = 2 * 30 * 24 * 60 * 60;\nclass AuthRouter extends base_1.BaseRouter {\n    constructor() {\n        super();\n        this.router = express.Router();\n        this.router.post('/login', this.route(this.login));\n        this.router.post('/register/', this.route(this.registerUser));\n        this.router.put('/forgetpass/', this.route(this.getPassword));\n        this.router.get('/gettoken', this.route(this.getToken));\n        this.router.post('/employee_login', this.route(this.employeeLogin));\n        this.router.post('/test', this.testMiddlewares());\n    }\n    testMiddlewares() {\n        return [\n            middlewares_1.authInfoMiddleware.run()\n        ];\n    }\n    getToken(req, res) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const token = yield services_1.tokenService.generateToken({}, \"admin\");\n            this.onSuccess(res, \"admin\", { token });\n        });\n    }\n    getPassword(req, res) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const md5Password = crypto.createHash(CONVERT_MD5).update(req.body.password).digest(ENCODING);\n            req.body.password = md5Password;\n            const result = yield controllers_1.userController.getPassword(req.body);\n            this.onSuccess(res, result);\n        });\n    }\n    registerUser(req, res) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (req.body.fullname == undefined) {\n                req.body.fullname = \"\";\n            }\n            if (req.body.sex == undefined) {\n                req.body.sex = \"OTHER\";\n            }\n            if (req.body.birthday == undefined) {\n                req.body.birthday = new Date();\n            }\n            if (req.body.address == undefined) {\n                req.body.address = \"\";\n            }\n            if (req.body.email == undefined) {\n                req.body.email = \"\";\n            }\n            const result = yield controllers_1.userController.create(req.body);\n            this.onSuccess(res, result);\n        });\n    }\n    login(req, res) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const md5_password = crypto.createHash(CONVERT_MD5).update(req.body.password).digest('hex');\n            req.body.password = md5_password;\n            const dataObtained = yield controllers_1.userController.checkLogin(req.body);\n            dataObtained.dataValues.role = \"USER\";\n            // var token = await tokenService.createJwtToken(dataObtained);\n            const token = yield services_1.tokenService.getUserToken(dataObtained.id);\n            this.onSuccess(res, dataObtained, { token });\n        });\n    }\n    employeeLogin(req, res) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.validateJSON(req.body, {\n                type: 'object',\n                properties: {\n                    id_token: {\n                        type: 'string'\n                    }\n                },\n                required: ['id_token']\n            });\n            const bearer = req.body.id_token.split(' ');\n            const bearerToken = bearer[1];\n            const result = yield controllers_1.authController.employeeLogin(bearerToken);\n            this.onSuccess(res, result);\n        });\n    }\n}\nexports.default = AuthRouter;\n//# sourceMappingURL=auth.js.map"]}